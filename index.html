<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>Alfred</title>
		<style>
			body {
				font-family: sans-serif;
				background: #cccccc;
			}
			/* .container {
				width: 80%;
				margin: 0 auto;
			} */
			/* custom class */
			.gantt .bar-milestone .bar {
				fill: tomato;
			}
		</style>
		
		<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="index.css">
		<link rel="stylesheet" href="frappe-gantt.css" />
		<link rel="stylesheet" href="chat_window.css">
		<link rel="stylesheet" href="batman-font-kit/stylesheet.css">
		<!-- <link rel="stylesheet" href="notification.css"> -->
		
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<script src="task-manage.js"></script>
		<script src="frappe-gantt.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

		

		<script type="text/javascript" src="chat_window.js"></script>
		<script type="text/javascript" src="planner_list.js"></script>

	</head>


	<body>

		<script src="conversation_manager.js"></script>

		<div class="container">

			<header>
				<h1 id="banner_title"><img src="raw_resources/alfred_head_mod_edeff2.jpg" id="banner_icon">ALFRED</h1>
			</header>

			<div class="chat_window">

				<!-- Top Menu -->
				<div class="top_menu">
					<div class="title">
						<input id="collap" class="collp_toggle" type="checkbox">
						<label for="collap" class="collp_lbl_toggle" >Room #6324</label>
					</div>
				</div>

				<!--Chat Content-->
				<ul class="messages">
				<li class="message left appeared">
					<div class="avatar"></div>
					<div class="text_wrapper">
						<div class="text">Hi, how can I help you?</div>
					</div>
				</li>
				</ul>

				<!-- clearfix -->
				<div class="bottom_wrapper">
					<div class="message_input_wrapper">
						<input type="text" name= "message" class="message_input" placeholder="Type your message here..." onfocus="this.placeholder='Aa'" onfocusout="this.placeholder='Type your message here...'">
					</div>
					<div class="send_message" onclick="sendMessage('test', 'rjw.png');">
						<div class="icon"></div>
						<div class="text"></div>
					</div>
				</div>
			</div>

			<div class="message_template">
				<li class="message">
					<div class="avatar"></div>
					<div class="text_wrapper">
						<div class="text"></div>
					</div>
				</li>
			</div>

			<div class="gantt-target"></div>

			<!-- <button onclick="myFunction()">Add task</button> -->

			<div class="planner_list">
				<h1 id="planner_list_title">Birthday Party Plan ðŸŽ‰ ðŸŽ‰ ðŸŽ‰ </h1>

				<!-- <button id="fadein"></button> -->
				<!-- <script>
					$(document).ready(function(){
						$("#fadein").click(function(){
							$("#img1").fadeIn(2000);
						});
					});
				</script> -->

				<ul>
					<!-- <li>
						<img src="sgy.png">
					</li>
					<li>
						<img src="hzl.png">
					</li>
					<li>
						<img src="zjh.png">
					</li>
					<li>
						<img src="rjw.png">
					</li>
					<li>
						<img src="lsl.png">
					</li> -->
				</ul>
			</div>

			<div class="planner_template">
				<li>
					<img>
				</li>
			</div>

		</div>

		<!-- <script>
			var tasks = [
				{
					start: '2018-10-01',
					end: '2018-10-08',
					name: 'Redesign website',
					id: "Task 0",
					progress: 20
				},
				{
					start: '2018-10-03',
					end: '2018-10-06',
					name: 'Write new content',
					id: "Task 1",
					progress: 5,
				},
				{
					start: '2018-10-04',
					end: '2018-10-08',
					name: 'Apply new styles',
					id: "Task 2",
					progress: 10,
				},
				{
					start: '2018-10-08',
					end: '2018-10-09',
					name: 'Review',
					id: "Task 3",
					progress: 5,
				},
				{
					start: '2018-10-12',
					end: '2018-10-12',
					name: 'Deploy',
					id: "Task 4",
					progress: 10,
				},
				{
					start: '2018-10-11',
					end: '2018-10-11',
					name: 'Go Live!',
					id: "Task 5",
					progress: 20,
					custom_class: 'bar-milestone'
				},
			];

			var tasks_roll = [
				{
					start: '2018-10-13',
					end: '2018-10-13',
					name: 'Dead line',
					id: "Task 6",
					progress: 30,
					custom_class: 'bar-milestone'
				}
			];

			var gantt_chart = new Gantt(".gantt-target",tasks_roll, {
				on_click: function (task) {
					console.log(task);
				},
				on_date_change: function(task, start, end) {
					console.log(task, start, end);
				},
				on_progress_change: function(task, progress) {
					console.log(task, progress);
				},
				on_view_change: function(mode) {
					console.log(mode);
				}
			});
			console.log(gantt_chart);
			function myFunction() {
				tasks_roll.push(tasks.pop());
				tasks_roll = arrangeTask(tasks_roll);
				gantt_chart.refresh(tasks_roll);
			}
		</script> -->
		<script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>

		<script>
		  function playSound(filename){
		      console.log("played!!!");
			var mp3Source = '<source src="' + filename + '.mp3" type="audio/mpeg">';
			var oggSource = '<source src="' + filename + '.ogg" type="audio/ogg">';
			var embedSource = '<embed hidden="true" autostart="true" loop="false" src="' + filename +'.mp3">';
			document.getElementById("sound").innerHTML='<audio autoplay="autoplay">' + mp3Source + oggSource + embedSource + '</audio>';
		  }
				// Initialize Firebase
				var config = {
					apiKey: "AIzaSyB2P8F_RKArqU7fkdMZ3y31pOQT-bwlYng",
					authDomain: "alfred-6f93d.firebaseapp.com",
					databaseURL: "https://alfred-6f93d.firebaseio.com",
					projectId: "alfred-6f93d",
					storageBucket: "alfred-6f93d.appspot.com",
					messagingSenderId: "639939505186"
				};
			firebase.initializeApp(config);

			let database = firebase.database();

			let ref = database.ref("/");

			ref.on("value", snapShot => {
			    playSound('quite-impressed');
			    		let res;
				res = snapShot.val();
				var ifSlack = false;
				let tasks_roll=[{
							actor: 0,
							duration: 0,
							name: 'ddl',
							isddl:1,
							start:date_utils.now(),
							end: date_utils.now(),
							id: 'Task 0',
							custom_class: 'bar-milestone',
					},];
				console.log(res.events);
				for(let task_name in res.events)
					{
						if(task_name==="sentences")
							continue;
						if(task_name==="eventDate") {
							tasks_roll[0].start = date_utils.parse(res.events[task_name]);
							tasks_roll[0].end = date_utils.parse(res.events[task_name]);
							continue;
						}
						if(task_name==="eventName") {
							tasks_roll[0].name = (res.events[task_name].replace('_', ' ').toUpperCase()+'ðŸ™ŒðŸ™Œ');
							continue;
						}
						if(task_name === "numOfTask")
						    continue;
						if(task_name === "slack")
						    continue;
						if(task_name === "buffer")
						    continue;

						let in_task = res.events[task_name];
						let new_name_frag = in_task.action.replace('_', ' ').split(' ');
						let new_name = "";
						for (frag of new_name_frag)
							new_name += (frag.charAt(0).toUpperCase()+frag.slice(1)+' ');
						let new_task=[{
							isddl:0,
							duration:in_task.duration,
							name: new_name,
							actor: in_task.actor,
							id: 'Task '+Math.random().toString(36).slice(2, 9),
						},];
						tasks_roll.push(new_task[0]);
					}


					tasks_roll = arrangeTask(tasks_roll,ifSlack);
				var gantt_chart = new Gantt(".gantt-target",tasks_roll, {
					on_click: function (task) {
						console.log(task);
					},
					on_date_change: function(task, start, end) {
						console.log(task, start, end);
					},
					on_progress_change: function(task, progress) {
						console.log(task, progress);
					},
					on_view_change: function(mode) {
						console.log(mode);
					}
			});
			// console.log(gantt_chart);

            });

			let userId2Avatar = new Map();
			let avatarsForChatWindow = ["lsl.png", "sgy.png", "zjh.png", "hzl.png", "rjw.png"];
			let avatarPtr = -1;

			let sent_ref = database.ref("/events/sentences");
			sent_ref.on("child_added", snapShot => {

			    if (avatarPtr >= 4) {
			        console.error("user id is illegal");
					return;
				}

				let newSentence = snapShot.val();

				let userId = newSentence.userId;
				if (userId2Avatar.has(userId)) {

				} else {
				    avatarPtr++;
				    userId2Avatar.set(userId, avatarsForChatWindow[avatarPtr]);
				}
                //
				// console.log(userId);
				// console.log(userId2Avatar);
				// console.log(avatarPtr);

			    sendMessage(newSentence.content, userId2Avatar.get(userId), "right");
			});
			console.log(date_utils.now());

			// var tasks = [
			// 	{
			// 	    duration:6,
			// 		actor:1,
			// 		name: 'Redesign website',
			// 		id: "Task 0",
			// 		progress: 20
			// 	},
			// 	{
			// 		duration:2,
			// 		actor:2,
			// 		name: 'Write new content',
			// 		id: "Task 1",
			// 		progress: 5,
			// 	},
			// 	{
			// 		duration:1,
			// 		actor:3,
			// 		name: 'Apply new styles',
			// 		id: "Task 2",
			// 		dependencies:"Task 6",
			// 		progress: 10,
			// 	},
			// 	{
			// 		duration:1,
			// 		actor:4,
			// 		name: 'Review',
			// 		id: "Task 3",
			// 		dependencies:"Task 5, Task 6",
			// 		progress: 5,
			// 	},
			// 	{
			// 		duration:2,
			// 		actor:5,
			// 		name: 'Deploy',
			// 		id: "Task 4",
			// 		progress: 10,
			// 	},
			// 	{
			// 		duration:4,
			// 		actor:1,
			// 		name: 'Go Live!',
			// 		id: "Task 5",
			// 		progress: 20,
			// 		custom_class: 'bar-milestone'
			// 	},
			// ]
			// var tasks_roll = [			{
			// 				start: '2018-10-16',
			// 				end: '2018-10-16',
			// 				actor:0,
			// 				duration: 0,
			// 				name: 'Dead line',
			// 				id: "Task 6",
			// 				progress: 30,
			// 				custom_class: 'bar-milestone'
			// 			},];
			// console.log(tasks_roll.length);
            //
			// var ifSlack = false;
			// function myFunction() {
			// 	// tasks_roll.push(tasks.pop());
			// 	tasks_roll = arrangeTask(tasks_roll,ifSlack);
			// 	gantt_chart.refresh(tasks_roll);
			// }
            //
			// function myFunction2() {
			// 	tasks_roll = arrangeTask(tasks_roll,true);
			// 	gantt_chart.refresh(tasks_roll);}
		</script>

		<!--<button onclick="myFunction()">Add task</button>-->
		<!--<button onclick="myFunction2()">Slack!</button>-->

		<script>

			// setInterval(_ => {
			// 	sendMessage("Hi I am hzl", "hzl.png", "right");
			// }, 1000);

			// setTimeout(_ => {
			// 	newPlanner("rjw", "rjw.png");
			// }, 1000);
			// setTimeout(_ => {
			// 	removePlanner('rjw');
			// }, 5000);


			/**
			 * sgy -> hzl -> zjh -> rjw -> lsl
			 * hzl -> zjh -> rjw -> lsl
			 * hzl -> lsl
			 */
			newPlanner("sgy", "sgy.png");
			newPlanner("hzl", "hzl.png");
			newPlanner("zjh", "zjh.png");
			newPlanner("rjw", "rjw.png");
			newPlanner("lsl", "lsl.png");
			// removePlanner("sgy");
			// removePlanner('zjh');
			// removePlanner('rjw');




		 </script>
		<div id="sound"></div>
	<button onclick="playSound('quite-impressed');">Play</button>

	</body>
</html>
