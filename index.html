<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>Alfred</title>
		<style>
			body {
				font-family: sans-serif;
				background: #cccccc;
			}
			/* .container {
				width: 80%;
				margin: 0 auto;
			} */
			/* custom class */
			.gantt .bar-milestone .bar {
				fill: tomato;
			}
		</style>
		
		<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="index.css">
		<link rel="stylesheet" href="frappe-gantt.css" />
		<link rel="stylesheet" href="chat_window.css">
		<link rel="stylesheet" href="batman-font-kit/stylesheet.css">
		<!-- <link rel="stylesheet" href="notification.css"> -->
		<link href="https://fonts.googleapis.com/css?family=Butterfly+Kids" rel="stylesheet">
		<link rel="stylesheet" href="wave.css">
		
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<script src="task-manage.js"></script>
		<script src="frappe-gantt.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

		

		<script type="text/javascript" src="chat_window.js"></script>
		<script type="text/javascript" src="planner_list.js"></script>

	</head>


	<body>

		<script src="conversation_manager.js"></script>

		<div class="container">

			<header>
				<h1 id="banner_title"><img src="raw_resources/alfred_head_mod_edeff2.jpg" id="banner_icon">ALFRED</h1>
			</header>

			<div class="chat_window">

				<!-- Top Menu -->
				<div class="top_menu">
					<div class="title">
						<input id="collap" class="collp_toggle" type="checkbox">
						<label for="collap" class="collp_lbl_toggle" >Room #6324</label>
					</div>
				</div>

				<!--Chat Content-->
				<ul class="messages">
				<li class="message right appeared">
					<div class="avatar"></div>
					<div class="text_wrapper">
						<!-- Hi, how can I help you? -->
						<div class="text">
							Hi, how can I help you?
						</div>
					</div>
				</li>
				</ul>

				<!-- clearfix -->
				<div class="bottom_wrapper">
					<div class="message_input_wrapper">
						<input type="text" name= "message" class="message_input" placeholder="Type your message here..." onfocus="this.placeholder='Aa'" onfocusout="this.placeholder='Type your message here...'">
					</div>
					<div class="send_message" onclick="sendMessage('test','fff');">
						<div class="icon"></div>
						<div class="text"></div>
					</div>
				</div>
			</div>

			<div class="message_template">
				<li class="message">
					<div class="avatar"></div>
					<div class="text_wrapper">
						<div class="text"></div>
					</div>
				</li>
			</div>

			<div class="gantt-target"></div>

			<!-- <button onclick="myFunction()">Add task</button> -->

			<div class="planner_list">
				<h1 id="planner_list_title"><span style="font-family: 'Butterfly Kids', cursive;font-weight: 900">Birthday Party Plan ðŸŽ‰ ðŸŽ‰ ðŸŽ‰</span> 

					<div id="tgbtn_container">
						<div class="tgbtn_inner">
							<div class="tgbtn">
								<p>slack</p>
							</div>
							<div class="tgbtn">
								<p>safe</p>
							</div>
						</div>
						<div class="tgbtn_inner" id='tgbtn'>
							<div class="tgbtn">
								<p>slack</p>
							</div>
							<div class="tgbtn">
								<p>safe</p>
							</div>
						</div>
					</div>

					<script>
						var toggle = document.getElementById('tgbtn_container');
						var toggleContainer = document.getElementById('tgbtn');
						var toggleNumber;
						var wasSlack=false;
						function toggle_button(ifSlack)
                        {
                            if(wasSlack!=ifSlack)
                            {
                                sendMeme('raw_resources/too_old2care.gif');
                                wasSlack=ifSlack;
                            }
							if (ifSlack) {
								toggleContainer.style.clipPath = 'inset(0 0 0 50%)';
								toggleContainer.style.backgroundColor = '#78c04b';
							} else {
								toggleContainer.style.clipPath = 'inset(0 50% 0 0)';
								toggleContainer.style.backgroundColor = 'dodgerblue';
							}
							console.log(toggleNumber);
						};
					</script>

				</h1>

				<!-- <button id="fadein"></button> -->
				<!-- <script>
					$(document).ready(function(){
						$("#fadein").click(function(){
							$("#img1").fadeIn(2000);
						});
					});
				</script> -->

				<ul>
					<!-- <li>
						<img src="sgy.png">
					</li>
					<li>
						<img src="hzl.png">
					</li>
					<li>
						<img src="zjh.png">
					</li>
					<li>
						<img src="rjw.png">
					</li>
					<li>
						<img src="lsl.png">
					</li> -->
				</ul>
			</div>

			<div class="planner_template">
				<li>
					<div style="float:left;margin-right: 6px">
						<img>
					</div>
				</li>
			</div>

			<div class="wave_template">
				<div class="wave">
					<div class="wave_frame">
						<div class="water"></div>
					</div>
				</div>
			</div>

		</div>
		<script>
            /*
			var tasks = [
				{
				    duration: 2,
                    actor: 3,
					name: 'Buy Decoration',
					id: "Task 2",
					progress: 5,
				},
				{
				    actor: 2,
				    duration: 2,
					name: 'Decorate',
					id: "Task 3",
					progress: 5,
				},
				{
				    actor: 1,
				    duration:2,
					name: 'Plan Game',
					id: "Task 4",
					progress: 5,
				},
				{
				    actor: 4,
				    duration:2,
					name: 'Buy Gift',
					id: "Task 5",
					progress: 5,
				},
                {
                    actor: 3,
				    duration:2,
					name: 'Booking room',
					id: "Task 6",
					progress: 5,
				},
                {
                    actor: 2,
					duration:2,
					name: 'Pick Up Cake',
					id: "Task 1",
					progress: 5,
				},
                {
                    actor: 1,
				    duration: 2,
					name: 'Order Cake',
					id: "Task 8",
					progress: 5,
				},
			];
			var tasks_roll = [
				{
				    actor: 0,
					start: '2018-10-13',
					end: '2018-10-13',
					name: 'Dead line',
					id: "Task 0",
					progress: 5,
					custom_class: 'bar-milestone'
				}
			];

			var gantt_chart = new Gantt(".gantt-target",tasks_roll, {
				on_click: function (task) {
					console.log(task);
				},
				on_date_change: function(task, start, end) {
					console.log(task, start, end);
				},
				on_progress_change: function(task, progress) {
					console.log(task, progress);
				},
				on_view_change: function(mode) {
					console.log(mode);
				}
			});
			console.log(gantt_chart);
			function myFunction() {
				tasks_roll.push(tasks.pop());
				tasks_roll = arrangeTask(tasks_roll);
				gantt_chart.refresh(tasks_roll);
			}
			*/
		</script>
        <button onclick="myFunction()" style='visibility: hidden'></button>
		<script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>

		<script>
		  function playSound(filename){
		      // console.log("played!!!");
			var mp3Source = '<source src="' + filename + '.mp3" type="audio/mpeg">';
			var oggSource = '<source src="' + filename + '.ogg" type="audio/ogg">';
			var embedSource = '<embed hidden="true" autostart="true" loop="false" src="' + filename +'.mp3">';
			document.getElementById("sound").innerHTML='<audio autoplay="autoplay">' + mp3Source + oggSource + embedSource + '</audio>';
		  }
				// Initialize Firebase
				var config = {
					apiKey: "AIzaSyB2P8F_RKArqU7fkdMZ3y31pOQT-bwlYng",
					authDomain: "alfred-6f93d.firebaseapp.com",
					databaseURL: "https://alfred-6f93d.firebaseio.com",
					projectId: "alfred-6f93d",
					storageBucket: "alfred-6f93d.appspot.com",
					messagingSenderId: "639939505186"
				};
			firebase.initializeApp(config);

			let database = firebase.database();

			let ref = database.ref("/");
            let workload = [];
            sendMeme('raw_resources/sum_total.gif');
			ref.on("value", snapShot => {
			    playSound('quite-impressed');
			    		let res;
				res = snapShot.val();
				var ifSlack = false;
				let tasks1=[],tasks2=[],cnt=1;
				let tasks_roll=[{
							actor: 0,
							duration: 1,
							name: 'ddl',
							isddl:1,
							start:date_utils.now(),
							end: date_utils.now(),
							id: 'Task 0',
							custom_class: 'bar-milestone',
                            progress: 5,
					},];
				console.log(res.events);
				for(let task_name in res.events)
					{
						if(task_name==="eventDate") {
							tasks_roll[0].start = date_utils.parse(res.events[task_name]);
							tasks_roll[0].end = date_utils.parse(res.events[task_name]);
							continue;
						}
						if(task_name==="eventName") {
							tasks_roll[0].name = (res.events[task_name].replace('_', ' ').toUpperCase()+'ðŸ™ŒðŸ™Œ');
							continue;
						}
						if(task_name === "numOfTask")
                        {
                            cnt = res.events[task_name];
                            continue;
                        }

						if(task_name === "slack") {
						    if(res.events[task_name] === "false")
                                ifSlack = false;
						    else if (res.events[task_name] === "true")ifSlack = true;
						    toggle_button(ifSlack);
                            continue;
                        }
						if(task_name === "buffer")
						    continue;
						if(task_name==="dependency") {
                            for(let dependency in res.events[task_name] )
                            {
                                if(res.events[task_name][dependency].task1 === "sampleTask1")
                                    continue;
                                let new_name_frag_1 = res.events[task_name][dependency].task1.replace('_', ' ').split(' ');
                                let new_name_1 = "";
						        for (frag of new_name_frag_1)
                                    new_name_1 += (frag.charAt(0).toUpperCase()+frag.slice(1)+' ');

                                let new_name_frag_2 = res.events[task_name][dependency].task2.replace('_', ' ').split(' ');
                                let new_name_2 = "";
						        for (frag of new_name_frag_2)
                                    new_name_2 += (frag.charAt(0).toUpperCase()+frag.slice(1)+' ');
                                tasks1.push(new_name_1);
                                tasks2.push(new_name_2);

                            }
							continue;
						}
						let in_task = res.events[task_name];
						let new_name_frag = in_task.action.replace('_', ' ').split(' ');
						let new_name = "";
						for (frag of new_name_frag)
							new_name += (frag.charAt(0).toUpperCase()+frag.slice(1)+' ');
						let new_task=[{
							isddl:0,
							duration:in_task.duration,
							name: new_name,
							actor: in_task.actor,
							id: 'Task '+cnt++,
                            progress: 5,
						},];
						tasks_roll.push(new_task[0]);
					}
                    for(let i=0;i<tasks2.length;i++)
                    {
                        for(let task of tasks_roll)
                            if(task.name === tasks2[i])
                            {
                                for(let tt of tasks_roll)
                                    if (tt.name === tasks1[i]) {
                                    if(!task.dependencies)
                                        task.dependencies = tt.id+',';
                                    else
                                        task.dependencies += (tt.id+',');
                                        break;
                                    }
                                break;
                            }
                    }

					tasks_roll = arrangeTask(tasks_roll,ifSlack);
				var gantt_chart = new Gantt(".gantt-target",tasks_roll, {
					on_click: function (task) {
						console.log(task);
					},
					on_date_change: function(task, start, end) {
						console.log(task, start, end);
					},
					on_progress_change: function(task, progress) {
						console.log(task, progress);
					},
					on_view_change: function(mode) {
						console.log(mode);
					}
			});
			console.log(gantt_chart);

			});

		</script>


		<script>

			// setInterval(_ => {
			// 	sendMessage("Hi I am hzl", "hzl.png", "right");
			// }, 1000);

			// setTimeout(_ => {
			// 	newPlanner("rjw", "rjw.png");
			// }, 1000);
			// setTimeout(_ => {
			// 	removePlanner('rjw');
			// }, 5000);


			/**
			 * sgy -> hzl -> zjh -> rjw -> lsl
			 * hzl -> zjh -> rjw -> lsl
			 * hzl -> lsl
			 */
			newPlanner("sgy", "sgy.png");
			newPlanner("hzl", "hzl.png");
			newPlanner("zjh", "zjh.png");
			newPlanner("rjw", "rjw.png");
			// newPlanner("lsl", "lsl.png");
			// removePlanner("sgy");
			// removePlanner('zjh');
			// removePlanner('rjw');



            // changeCapacity('zjh',0.3);
		 </script>
		<div id="sound"></div>
	<!--<button onclick="playSound('quite-impressed');">Play</button>-->
    <!--<button onclick="toggle_button(true)">toggle</button>-->

	</body>
</html>
